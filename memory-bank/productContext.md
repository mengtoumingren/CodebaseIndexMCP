# Product Context

此文件提供项目的总体概述和预期创建的产品。最初基于 projectBrief.md（如果提供）和工作目录中所有其他可用的项目相关信息。此文件旨在随着项目的发展而更新，应用于告知所有其他模式项目的目标和上下文。
2025-06-14 09:30:00 - 更新日志将作为脚注附加到此文件末尾。

## 项目目标

**CoodeBaseApp** 是一个企业级的代码索引和语义搜索 MCP 服务器，旨在为开发团队提供智能的代码查询和理解能力。

**核心目标**：
* 为 Model Context Protocol (MCP) 客户端提供强大的代码语义搜索功能
* 支持多代码库的统一索引管理和查询
* 提供准确的代码解析和智能的代码片段提取
* 建立可扩展的多语言代码解析框架
* 实现高效的增量索引更新和文件变更监控

## 关键特性

**核心功能**：
* 🔍 **语义代码搜索**：基于自然语言查询的智能代码片段检索
* 📚 **多代码库管理**：支持创建和管理多个独立的代码库索引
* 🔄 **增量索引更新**：智能的文件变更检测和增量重建机制
* 👁️ **实时文件监控**：自动检测文件变更并更新索引
* 🎯 **多语言解析**：基于 Roslyn 的 C# 解析器，预留其他语言扩展接口

**技术特性**：
* 🌐 **多嵌入向量提供商**：支持 DashScope、OpenAI、Azure OpenAI、HuggingFace
* 💾 **任务持久化**：支持索引任务的断点续传和服务重启恢复
* 🔗 **连接监控**：Qdrant 数据库连接状态监控和自动重连
* ⚙️ **灵活配置**：完整的配置管理和服务注册机制
* 🛡️ **健壮性设计**：完善的错误处理、日志记录和状态管理

## 整体架构

**分层架构设计**：

1. **MCP 协议层**：
   - 基于 Microsoft.Extensions.Hosting 的控制台主机
   - 标准输入输出通信协议 (WithStdioServerTransport)
   - CreateIndexLibrary 和 SemanticCodeSearch 工具提供

2. **业务逻辑层**：
   - EnhancedCodeSemanticSearch：核心语义搜索服务
   - IndexingTaskManager：索引任务管理和执行
   - FileWatcherService：文件变更监控和处理
   - IndexConfigManager：配置管理和持久化

3. **代码解析层**：
   - 多语言解析框架：ICodeParser 抽象接口
   - C# Roslyn 解析器：基于 Microsoft.CodeAnalysis
   - 语言检测和解析器工厂机制

4. **嵌入向量层**：
   - 统一的 IEmbeddingProvider 接口
   - 多提供商支持：DashScope、OpenAI、Azure OpenAI、HuggingFace
   - 配置驱动的提供商选择和管理

5. **数据存储层**：
   - Qdrant 向量数据库：代码片段向量存储和检索
   - 本地 JSON 配置：代码库映射和索引配置
   - 任务持久化：本地文件系统的任务状态管理

**关键设计模式**：
* 工厂模式：解析器和嵌入向量提供商创建
* 策略模式：不同嵌入向量提供商的统一接口
* 观察者模式：文件变更监控和索引更新
* 模板方法模式：索引任务的标准化执行流程