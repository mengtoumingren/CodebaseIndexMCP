# Decision Log

此文件使用列表格式记录架构和实现决策。
2025-06-14 09:30:00 - 更新日志。

*

## 决策

*

## 理由

*

## 实现细节

*
[2025-06-14 10:19:00] - **MCP 服务器架构决策**
## 决策
创建基于现有 CodeSemanticSearch 的轻量级 MCP 控制台应用程序，仅提供 SemanticCodeSearch 工具，移除 IndexCodebase 工具以简化实现。

## 理由
1. 用户明确表示不需要 IndexCodebase 功能
2. 简化架构降低复杂性和维护成本
3. 专注于核心语义搜索功能
4. 利用现有的 CodeSemanticSearch.cs 实现

## 实现细节
- 使用 Microsoft.Extensions.Hosting 创建控制台主机
- 配置 WithStdioServerTransport() 用于标准输入输出通信
- 单一 SemanticCodeSearch 工具支持自然语言代码搜索
- 通过配置文件管理默认代码库路径和 API 密钥
[2025-06-14 14:51:00] - **MCP 工具用户体验优化决策**

## 决策

优化 MCP 工具的描述和参数说明，提升工具的可用性和用户理解度。

## 理由

1. 原有的工具描述过于简洁，用户难以理解使用场景
2. 参数说明不够详细，特别是路径格式要求不明确
3. 缺少使用提示和示例，影响工具的易用性
4. 需要明确默认行为和参数要求

## 实现细节

- 工具描述增加使用场景提示："当需要查看项目中特定功能或逻辑的代码实现时"
- codebasePath 参数明确默认使用当前工作目录，要求提供完整绝对路径
- query 参数增加更多搜索示例："异常处理机制"、"配置管理"等
- limit 参数明确默认值说明
- 所有描述更加详细和实用
[2025-06-15 07:53:00] - **增量重建索引架构决策**

## 决策

实施基于文件修改时间的增量重建索引功能，避免全量重建造成的资源浪费。

## 理由

1. **性能优化需求**：全量重建对大型代码库耗时过长，用户体验差
2. **资源效率**：避免重复索引未变更文件，节省计算资源和时间
3. **实时性要求**：快速响应文件变更，保持索引的时效性
4. **扩展性考虑**：为未来支持更大规模代码库奠定基础

## 实现细节

* **数据模型扩展**：
  - 在 `CodebaseMapping` 中添加 `FileIndexDetails` 列表
  - 每个文件记录最后索引时间和可选的文件哈希
  - 使用规范化的相对路径确保跨平台一致性

* **增量算法设计**：
  - 文件删除检测：对比 `FileIndexDetails` 与当前物理文件
  - 文件修改检测：比较文件修改时间与最后索引时间
  - 文件新增检测：在 `FileIndexDetails` 中不存在的文件

* **集成策略**：
  - 复用现有的任务管理、连接监控、文件监控系统
  - 保持向后兼容性，不影响现有索引流程
  - 统一的错误处理和状态报告机制

* **技术选择**：
  - 使用 `File.GetLastWriteTimeUtc()` 进行变更检测（暂不实现文件哈希）
  - 基于相对路径的文件标识，支持代码库迁移
  - 异步执行确保UI响应性